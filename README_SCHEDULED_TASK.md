# 微信公众号爬虫 - 定时任务使用说明

## 📋 功能说明

这个定时任务系统提供了以下功能：

- 在指定时间（默认明天凌晨 00:01）自动执行一次微信公众号爬虫
- 支持自定义执行时间
- 提供倒计时显示和进度提醒
- 支持立即执行模式用于测试
- 详细的日志记录和错误处理

## 🚀 使用方法

### 方法 1：使用批处理文件（推荐）

#### 1. 定时执行（明天凌晨 00:01）

双击运行 `定时启动.bat` 文件，程序会：

- 计算距离明天凌晨 00:01 的时间差
- 显示倒计时
- 在指定时间自动执行爬虫任务
- 执行完成后程序自动退出

#### 2. 立即执行（用于测试）

双击运行 `立即执行.bat` 文件，程序会：

- 跳过等待时间
- 立即执行爬虫任务
- 用于测试脚本是否正常工作

### 方法 2：使用命令行

在项目根目录下打开 PowerShell 或命令提示符：

#### 默认定时执行（明天 00:01）

```bash
.\venv\Scripts\python.exe scheduled_task.py
```

#### 自定义执行时间

```bash
# 明天凌晨2点30分执行
.\venv\Scripts\python.exe scheduled_task.py --hour 2 --minute 30

# 明天中午12点执行
.\venv\Scripts\python.exe scheduled_task.py --hour 12 --minute 0
```

#### 立即执行（测试模式）

```bash
.\venv\Scripts\python.exe scheduled_task.py --now
```

## 📊 程序输出说明

### 启动阶段

```
============================================================
微信公众号爬虫 - 定时任务启动
============================================================
当前时间: 2024-09-24 15:30:25
目标执行时间: 2024-09-25 00:01:00
等待时间: 30635 秒 (8.5 小时)
============================================================
```

### 等待阶段

```
⏰ 距离执行还有 8 小时
⏰ 距离执行还有 7 小时
...
⏰ 距离执行还有 4 分 0 秒
⏰ 距离执行还有 3 分 0 秒
...
⏰ 30 秒后执行任务...
⏰ 29 秒后执行任务...
```

### 执行阶段

```
============================================================
开始执行微信公众号爬虫任务
============================================================
工作目录: d:\mynj\wechat_crawler0919
Python解释器: d:\mynj\wechat_crawler0919\venv\Scripts\python.exe
执行脚本: d:\mynj\wechat_crawler0919\start.py
执行命令: .\venv\Scripts\python.exe start.py
任务开始时间: 2024-09-25 00:01:00
任务结束时间: 2024-09-25 00:45:32
执行耗时: 0:44:32
✅ 爬虫任务执行成功
```

## ⚠️ 注意事项

1. **运行环境**：

   - 确保虚拟环境 `venv` 已正确安装
   - 确保 `start.py` 脚本存在且可执行
   - 程序会自动切换到项目根目录执行

2. **中途停止**：

   - 在等待阶段可以按 `Ctrl+C` 停止程序
   - 在执行阶段中断可能导致爬虫任务不完整

3. **错误处理**：

   - 程序会检查所需文件是否存在
   - 执行失败会显示详细错误信息
   - 所有日志会保存到 `logs/wechat_crawler.log`

4. **时间设置**：
   - 目标时间是基于当前日期的"明天"计算
   - 如果当前时间已过目标时间，会立即执行
   - 支持 0-23 小时，0-59 分钟的时间设置

## 🔧 自定义配置

如果需要修改默认执行时间，可以编辑 `scheduled_task.py` 文件中的默认参数：

```python
def run(self, target_hour=0, target_minute=1):  # 修改这里的默认值
```

## 📝 日志文件

- 程序运行日志会保存在 `logs/wechat_crawler.log`
- 包含详细的执行时间、状态和错误信息
- 可以用来排查问题和查看执行历史

## 🆘 常见问题

**Q: 程序显示"Python 解释器不存在"？**
A: 检查虚拟环境是否正确安装，路径是否正确

**Q: 程序显示"启动脚本不存在"？**
A: 确保 `start.py` 文件在项目根目录

**Q: 想要每天定时执行怎么办？**
A: 可以使用 Windows 任务计划程序，每天运行 `定时启动.bat`

**Q: 如何查看执行结果？**
A: 查看控制台输出和 `logs/wechat_crawler.log` 日志文件
